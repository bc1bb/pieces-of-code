pico-8 cartridge // http://www.pico-8.com
version 41
__lua__
function _init()
	p={x=60,y=110,hp=3}
	bullets={}
	enn={}
	enn_b={}
	lastcheck=-1
	spawnspeed=1
	gameover=false
end

function _update60()
	if gameover then
		if (btn(❎)) then
		 p={x=60,y=110,hp=10}
		 gameover = false
		end
		return
	end
	
	if p.hp == 0 then
	 gameover = true
	 return
	end
	
 if (btn(➡️) and p.x<120) p.x+=1
 if (btn(⬅️) and p.x>0) p.x-=1
 if (btn(⬆️) and p.y>0) p.y-=1
 if (btn(⬇️) and p.y<120) p.y+=1
	if (btnp(❎)) shoot()
	
	update_bullets()
	update_e()
	update_eb()

	-- stat(95) rtc second
	if (lastcheck != stat(95)) then
  lastcheck=stat(95)
  
		if (stat(95) % spawnspeed  == 0) then
			e_spawn()
		end
	end
end

function _draw()
	cls()

 if (gameover) then
  return
 end

	spr(1,p.x,p.y)
	
	for i in all(bullets) do
		if i.c then
			del(bullets,i)
		else
			if (i.y<=0) then del(bullets,i)
			else spr(17,i.x,i.y)
			end
		end
	end
	
	for i in all(enn_b) do
		spr(18,i.x,i.y)
	end
	
	for i in all(enn) do
	 if i.hp == 0 then
	 	del(enn,i)
	 else spr(2,i.x,i.y)
	 end
	end
end
-->8
-- player bullets --

function shoot()
  b = {
   c=false,
			x=p.x,
			y=p.y
		}
	add(bullets, b)
	sfx(0)
end

function update_bullets()
	for b in all(bullets) do
		b.y-=1
		
		for e in all(enn) do
			if (coll(b,e)) then
				b.c = true
				e.hp-=1
			end
		end
	end
end
-->8
-- ennemies --

function e_spawn()
 if time() % 5 then
		new_enn = {
		  hp=1,
				x=rnd(110),
				y=rnd(30)
			}
		add(enn, new_enn)
		
		e_shoot(new_enn.x, new_enn.y)
	end
end

function e_shoot(ex, ey)
	new_eb = {
			x=ex,
			y=ey
		}
	add(enn_b, new_eb)
end

function update_e()
	-- maybe?
end

function update_eb()
	for b in all(enn_b) do
		b.y+=1
		
		if (coll(b,p)) then
		 del(enn_b,b)
			p.hp-=1
		end
	end
end
-->8
-- collision --

function coll(a,b)
	 if a.x > b.x + 4
  or a.y > b.y + 4
  or a.x + 4 < b.x
  or a.y + 4 < b.y then
    return false
  else
    return true
  end
end
__gfx__
00000000000000000000400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000f00f000004440000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0070070000f00f000044444000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00077000003003000004440000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00077000033333300000300000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00700700333333330000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000033333300000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000009009000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000a00a000000100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000b00b000000200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000009009000000500000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
__sfx__
000100002d0502a050270501f0501b0501805014050100500b050080501200011000100000e0000d0000c0000c0000c0000b0001d000000000400009000100000200028000320000000000000000000000000000
000200002d0502a050270501f0501b0501805014050100500b050080501200011000100000e0000d0000c0000c0000c0000b0001d000000000400009000100000200028000320000000000000000000000000000
